
# KMS Usage 


## HTTP ROOT

Default URL:
* http://localhost:8080/kms/

Working examples: 
TODO


## Links for checking status

* *http://localhost:8080/kms/management/health*
* *http://localhost:8080/kms/management/metrics*
* *http://localhost:8080/kms/api/profile-info*

## KMS cURL examples


* KMSInit


    curl -X POST \
    http://localhost:8080/kms/keymanagement/identity/v1/init \
      -H 'Authorization: Bearer eyJraWQiOiJXeGplT3lZV2pwTXZUS3lTZTJvNlRnV01vM0lhalJWWXUyR2YxaVR5ZkpZIiwiYWxnIjoiUlMyNTYifQ.eyJtY3B0dF9pZCI6InRlc3QyQGV4YW1wbGUub3JnIiwic3ViIjoiYWRtaW4iLCJhdWQiOlsiaHR0cDpcL1wvbG9jYWxob3N0OjUyMjdcL2thYXMiLCJwdHQiLCJrbSIsImNtIiwiZ20iXSwic2NwIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciIsIjNncHA6bWNwdHQ6a2V5X21hbmFnZW1lbnRfc2VydmVyIiwiM2dwcDptY3B0dDpjb25maWdfbWFuYWdlbWVudF9zZXJ2ZXIiLCIzZ3BwOm1jcHR0Omdyb3VwX21hbmFnZW1lbnRfc2VydmVyIl0sIm5iZiI6MTUxMTI3MTkwNywiaXNzIjoiaHR0cDpcL1wvbG9jYWxob3N0OjUyMjdcL2thYXMiLCJleHAiOjE4MjY2MzE5MDcsImlhdCI6MTUxMTI3MTkwNywianRpIjoiNjFmMGY2NGYtOTUyZC00ODc2LTgwNTgtZWQ0ZjE3ZGJhNjI1IiwiY2lkIjoiZGUyYmNmZjItNzQxZi00NTE0LThiMDEtMDcxOTg3NjU5ZjNlIn0.foynAhKM852iSB0C8ABcJ5pZenjMXRJuFXii_BEr5HYuyA7YBgm7L8Nw7m8ff4mmVe18c5MThzrrdFE_HZmqd5ORT6Q7cLrJI6tT8FKgwvtRbJ0boCqrEkjkDsX1VW85M-VQnkXWpMYzlH2sWl_XxzXYGwDDfhKxGmloHgMmHySOAybwQJuRaiuGSjtQLUBubzN9Yjk_OXTf5IQSNjHA7Zn_3FzoFq8yUuo7Te6wm9yIq_n-olLU7TCKhtPg4WMdpsz_iT3B0L7yoMivfjU4tuod-vX8U7kItXT14h-eUbeGAJk09zB6XfDwH9UI9D6xkDE9R-NnBKBzcx9aMt58SA' \
      -H 'Cache-Control: no-cache'

* KMSKeyProv


    curl -X POST \
      http://localhost:8080/kms/keymanagement/identity/v1/keyprov \
      -H 'Authorization: Bearer eyJraWQiOiJXeGplT3lZV2pwTXZUS3lTZTJvNlRnV01vM0lhalJWWXUyR2YxaVR5ZkpZIiwiYWxnIjoiUlMyNTYifQ.eyJtY3B0dF9pZCI6InRlc3QyQGV4YW1wbGUub3JnIiwic3ViIjoiYWRtaW4iLCJhdWQiOlsiaHR0cDpcL1wvbG9jYWxob3N0OjUyMjdcL2thYXMiLCJwdHQiLCJrbSIsImNtIiwiZ20iXSwic2NwIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciIsIjNncHA6bWNwdHQ6a2V5X21hbmFnZW1lbnRfc2VydmVyIiwiM2dwcDptY3B0dDpjb25maWdfbWFuYWdlbWVudF9zZXJ2ZXIiLCIzZ3BwOm1jcHR0Omdyb3VwX21hbmFnZW1lbnRfc2VydmVyIl0sIm5iZiI6MTUxMTI3MTkwNywiaXNzIjoiaHR0cDpcL1wvbG9jYWxob3N0OjUyMjdcL2thYXMiLCJleHAiOjE4MjY2MzE5MDcsImlhdCI6MTUxMTI3MTkwNywianRpIjoiNjFmMGY2NGYtOTUyZC00ODc2LTgwNTgtZWQ0ZjE3ZGJhNjI1IiwiY2lkIjoiZGUyYmNmZjItNzQxZi00NTE0LThiMDEtMDcxOTg3NjU5ZjNlIn0.foynAhKM852iSB0C8ABcJ5pZenjMXRJuFXii_BEr5HYuyA7YBgm7L8Nw7m8ff4mmVe18c5MThzrrdFE_HZmqd5ORT6Q7cLrJI6tT8FKgwvtRbJ0boCqrEkjkDsX1VW85M-VQnkXWpMYzlH2sWl_XxzXYGwDDfhKxGmloHgMmHySOAybwQJuRaiuGSjtQLUBubzN9Yjk_OXTf5IQSNjHA7Zn_3FzoFq8yUuo7Te6wm9yIq_n-olLU7TCKhtPg4WMdpsz_iT3B0L7yoMivfjU4tuod-vX8U7kItXT14h-eUbeGAJk09zB6XfDwH9UI9D6xkDE9R-NnBKBzcx9aMt58SA' \
      -H 'Cache-Control: no-cache' 
  
* KMSKeyProv with user


    curl -X POST \
      http://localhost:8080/kms/keymanagement/identity/v1/keyprov/user10@example.org/ \
      -H 'Authorization: Bearer eyJraWQiOiJXeGplT3lZV2pwTXZUS3lTZTJvNlRnV01vM0lhalJWWXUyR2YxaVR5ZkpZIiwiYWxnIjoiUlMyNTYifQ.eyJtY3B0dF9pZCI6InRlc3QyQGV4YW1wbGUub3JnIiwic3ViIjoiYWRtaW4iLCJhdWQiOlsiaHR0cDpcL1wvbG9jYWxob3N0OjUyMjdcL2thYXMiLCJwdHQiLCJrbSIsImNtIiwiZ20iXSwic2NwIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciIsIjNncHA6bWNwdHQ6a2V5X21hbmFnZW1lbnRfc2VydmVyIiwiM2dwcDptY3B0dDpjb25maWdfbWFuYWdlbWVudF9zZXJ2ZXIiLCIzZ3BwOm1jcHR0Omdyb3VwX21hbmFnZW1lbnRfc2VydmVyIl0sIm5iZiI6MTUxMTI3MTkwNywiaXNzIjoiaHR0cDpcL1wvbG9jYWxob3N0OjUyMjdcL2thYXMiLCJleHAiOjE4MjY2MzE5MDcsImlhdCI6MTUxMTI3MTkwNywianRpIjoiNjFmMGY2NGYtOTUyZC00ODc2LTgwNTgtZWQ0ZjE3ZGJhNjI1IiwiY2lkIjoiZGUyYmNmZjItNzQxZi00NTE0LThiMDEtMDcxOTg3NjU5ZjNlIn0.foynAhKM852iSB0C8ABcJ5pZenjMXRJuFXii_BEr5HYuyA7YBgm7L8Nw7m8ff4mmVe18c5MThzrrdFE_HZmqd5ORT6Q7cLrJI6tT8FKgwvtRbJ0boCqrEkjkDsX1VW85M-VQnkXWpMYzlH2sWl_XxzXYGwDDfhKxGmloHgMmHySOAybwQJuRaiuGSjtQLUBubzN9Yjk_OXTf5IQSNjHA7Zn_3FzoFq8yUuo7Te6wm9yIq_n-olLU7TCKhtPg4WMdpsz_iT3B0L7yoMivfjU4tuod-vX8U7kItXT14h-eUbeGAJk09zB6XfDwH9UI9D6xkDE9R-NnBKBzcx9aMt58SA' \
      -H 'Cache-Control: no-cache'
  

* KMSKeyProv with user and time


    curl -X POST \
      http://localhost:8080/kms/keymanagement/identity/v1/keyprov/test18@example.org/DDA0360000000000 \
      -H 'Authorization: Bearer eyJraWQiOiJXeGplT3lZV2pwTXZUS3lTZTJvNlRnV01vM0lhalJWWXUyR2YxaVR5ZkpZIiwiYWxnIjoiUlMyNTYifQ.eyJtY3B0dF9pZCI6InRlc3QyQGV4YW1wbGUub3JnIiwic3ViIjoiYWRtaW4iLCJhdWQiOlsiaHR0cDpcL1wvbG9jYWxob3N0OjUyMjdcL2thYXMiLCJwdHQiLCJrbSIsImNtIiwiZ20iXSwic2NwIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciIsIjNncHA6bWNwdHQ6a2V5X21hbmFnZW1lbnRfc2VydmVyIiwiM2dwcDptY3B0dDpjb25maWdfbWFuYWdlbWVudF9zZXJ2ZXIiLCIzZ3BwOm1jcHR0Omdyb3VwX21hbmFnZW1lbnRfc2VydmVyIl0sIm5iZiI6MTUxMTI3MTkwNywiaXNzIjoiaHR0cDpcL1wvbG9jYWxob3N0OjUyMjdcL2thYXMiLCJleHAiOjE4MjY2MzE5MDcsImlhdCI6MTUxMTI3MTkwNywianRpIjoiNjFmMGY2NGYtOTUyZC00ODc2LTgwNTgtZWQ0ZjE3ZGJhNjI1IiwiY2lkIjoiZGUyYmNmZjItNzQxZi00NTE0LThiMDEtMDcxOTg3NjU5ZjNlIn0.foynAhKM852iSB0C8ABcJ5pZenjMXRJuFXii_BEr5HYuyA7YBgm7L8Nw7m8ff4mmVe18c5MThzrrdFE_HZmqd5ORT6Q7cLrJI6tT8FKgwvtRbJ0boCqrEkjkDsX1VW85M-VQnkXWpMYzlH2sWl_XxzXYGwDDfhKxGmloHgMmHySOAybwQJuRaiuGSjtQLUBubzN9Yjk_OXTf5IQSNjHA7Zn_3FzoFq8yUuo7Te6wm9yIq_n-olLU7TCKhtPg4WMdpsz_iT3B0L7yoMivfjU4tuod-vX8U7kItXT14h-eUbeGAJk09zB6XfDwH9UI9D6xkDE9R-NnBKBzcx9aMt58SA' \
      -H 'Cache-Control: no-cache' 


## KAAS cURL examples

Params:
client_id - user must be configurated on the KAAS.
sid_cookie_value â€“ retrieved from KAAS session 

Authorization request (gets authorization code):
    
    curl -i --cookie "sid=<sid_cookie_value>"  'http://localhost:5227/kaas/oauth2/authorize?response_type=code&client_id=<client_id>&redirect_uri=http%3A%2F%2Fexample.com&scope=openid+3gpp%3Amcptt%3Aptt_server+3gpp%3Amcptt%3Akey_management_server+3gpp%3Amcptt%3Aconfig_management_server+3gpp%3Amcptt%3Agroup_management_server&state=qwerty'

To get access token:
    
    curl -i -X POST -H "Content-Type: application/x-www-form-urlencoded" 'http://localhost:5227/kaas/oauth2/token?grant_type=authorization_code&code=<authorization_code>&redirect_uri=http%3A%2F%2Fexample.com&client_id=<client_id>'

To get access token with refresh token:
    
    curl -i -X POST -H "Content-Type: application/x-www-form-urlencoded" 'http://localhost:5227/kaas/oauth2/token?grant_type=refresh_token&refresh_token=<refresh_token>&client_id=<client_id>'


